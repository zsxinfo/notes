# Lua —— 被误解的语言

2021年1月15日 星期五

Lua是我最爱的语言之一。我有个老的教育网站的CMS（Content Management System）就是用它写的。这个网站教人创造IoT硬件项目，写小游戏，以及探索去中心网络。时至今日，我仍然认为我不是Lua方面的专家，我顶多算个合格的Lua用户。我的意思是这些年以来我经常用Lua的环境，但是我从未深入了解Lua的实现以及Lua的生态。因此，当我看到博客文章说Lua语言没有达到其目标以及流行度，我感到有些难过。通常这些文章读起来像是抱怨，或者要求清单。最近，我读到在LWN上的一篇*关于Lua缺乏电池*的文章，以及*该文在HackerNews上的讨论*，使得我想写写。本文可能引用上述两篇post的部分内容。

## Lua 应该被认为是工具箱

应该是Hisham在LuaConf2017演讲里说Lua是极简主义的。（aka "there are zero ways to do it"）。这当然说的是Lua "offering mechanisms over policies", 或者 "how it unlocks agency in the developer by letting them adapt the language to suit their environment and not vice versa." Lua就是基础的配料，你想加什么就加什么。假如你要做水果冰沙，lua就像是牛奶，你想加什么水果就加什么水果。

那些说lua缺乏电池的人想要的是，有着各种选项的已经创建好了的工具箱。他们并没有看到真正看到lua真正存在的意义。就好像指着一艘船却抱怨它不会飞。它本来就不是造出来飞的。除非你把它改造成水上飞机。但这是你的事情，关lua啥事啊。

lua自始至终就是一门脚本应用语言。基本上用lua就意味着用其他语言来写主要部分，然后内置一个lua引擎来增添灵活性。你写游戏吗？引擎都不是lua写的，lua只是用作脚本，用lua就可以在不用重新编译情况下更新游戏内容。

用lua写其他软件也是这么干的。主要是写插件。这就是lua设计出来的使命，尽管你可以用lua写整个软件，但这只是lua设计出来后的副作用，并不是它的主要用途。

他们没有意识到其实有很多自带电池的lua分发版本存在。有些开发者选择了lua，加了自己要的东西，然后就成了自己的版本。你也可以自己写自己的版本。我们不期待lua team at PUC来做这些事。本来就应该是现在这个样子。自己选语言，自己组装组件。

这样写出来才能是健康的软件，因为开发者自己决定自己负责。开发者完全控制，自主决定什么才是适合自己的开发环境。不像Elm社区，lua团队完全无法防止你做你想做的事情。你直接抓源码，然后完全不鸟lua社区都完全OK。

当你在自己的软件中内置lua的时候，你才能真正的感激lua。只有当你试图用两种语言（例如C和lua）来写东西的时候，lua的强大才会击中你。不仅lua的强大，而且lua的哲学会击中你。如果你用100%lua写东西，你就会感觉这不过就是另一种脚本语言，就像python或者ruby，然后你就会开始分析lua和其他语言的不同，然而这完全不可比，因为设计这些语言的目的完全不同。

## 关于数组下标从1开始的抱怨

我经常看到这种抱怨，通常这类人认为C语言的方式才是正确的方式。如果这类人多想想为什么数组下标从0开始就好了。C数组下标从0开始是因为，事实上，下标就是为了方便在内存中查找数据的位置，计算偏移量时的一个乘数。假设你有一个数组，有一个指针指向数组开始位置，每个数组元素大小已知，你只要把元素大小乘以数组下标，加上指针的值，你就得到了数组下标所指向的元素的指针地址。就是这么简单。因为C基本上只给你一个指针，所以数组下标从0开始就是为了方便你在内存中找东西。

当考虑到人类认知的时候，从1开始就显得合理了。当你排队买奶茶的时候，你会说我在队伍第一个，我敢说你不会说我在第0个。数数都是从1开始数的呀。当婴儿出生度过一个地球绕太阳周期后，我们会说婴儿1岁了，而不是0岁了。而且从1开始帮助你当你使用迭代器的时候，你不需要用各种i-1或者i < total之类的hacks。从1数到total完全OK，就是正常人思维。如果我没记错的话，Pascal就是这样的。恕我直言（IMHO），Pascal怎么爱都不为过。

## 关于面向对象的抱怨

Lua不是面向对象的。Lua有一种很灵活的数据结构叫做table。Lua还有Meta Tables，使用它可以更灵活。这个东西可以当作工具箱来用。（你能看到一种主题吗？）用tables和meta tables，你能建立像名字空间、面向对象系统等一堆酷玩意儿。你控制一切。你想建立一个像NewtonScript的有双父原型继承的系统吗？你可以这么干。Lua只提供机器，没有政策。你用这个机器建造什么东西完全取决于你。你不会绑在PUC或者其他什么库提供给你的东西。

## lua替代者

我不是针对Janet。我喜欢Janet。很多人没有意识到Lua是极其灵活的。Lua可以用c89标准的编译器编译（尽管默认是c99 IIRC)，对跑的硬件的要求很低。这让lua成为了硬件嵌入和软件嵌入式开发的主要候选人。许多被吹捧为lua代替者的语言耗费更多资源并且对硬件和操作系统有更多要求。尽管Janet仍然很棒（用c89 编译IIRC）。

Lua挺小的，我不是说二进制文件大小或者资源使用小。我说的只是源码复杂度小。Lua小到足够使菜鸟开发者能够理解其内部原理并记在心里。这使得其非常适合学术研究。容易理解的语言促进实验。Lua定位特别好，在学术研究和实践中都用得不少。

## 尾声

最初我想叫*结论*但感觉不对。这只是一篇讨论Lua的小文，所以与其说是结论，不如说是建议——仅供参考——所以你可以有你自己的结论。

我不是计算机科学家。我在1998到2001之间是PUC-Rio的一名学生，尽管我当时就在用老的CGILua，但是我从未见过Lua团队当时。我没有读者们可能有的各种学术背景，但这不妨碍我使用或者享受Lua。我曾在LuaConf2017演讲，当时展示了我自个儿造的一个联网自动饮料搅拌机。我选择Lua因为我感觉就是它了。我想要的不是一种充满电池和选项的语言。我想要的是工具箱的一些工具，刚好有足够的工具使得我能够造我想要的东西。

当你用Lua，不要把它看作一个产品。把它看作乐高。Lua提供砖块，你提供想象力和设计，最终你造出了产品。

哦，想看我的饮料搅拌机的看这里（youtube视频）。

<br><br>

原链接：
https://andregarzia.com/2021/01/lua-a-misunderstood-language.html

2022/10/2 zsxinfo笔记

